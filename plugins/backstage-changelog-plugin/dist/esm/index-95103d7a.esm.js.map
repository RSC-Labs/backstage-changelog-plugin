{"version":3,"file":"index-95103d7a.esm.js","sources":["../../src/api/ChangelogApi.ts","../../src/routes.ts","../../src/api/ChangelogClient.ts","../../src/plugin.ts","../../src/util/constants.ts"],"sourcesContent":["/*\n * Copyright 2023 RSC-Labs, https://rsoftcon.com/\n *\n * Licensed under the Mozilla Public License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     https://www.mozilla.org/en-US/MPL/2.0/\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Entity } from '@backstage/catalog-model';\nimport { createApiRef } from '@backstage/core-plugin-api';\n\n/** @public */\nexport const changelogApiRef = createApiRef<ChangelogApi>({\n    id: 'plugin.changelog.client',\n});\n\n/** @public */\nexport interface ChangelogApi {\n    readChangelog(entity: Entity): Promise<string>;\n}","/*\n * Copyright 2023 RSC-Labs, https://rsoftcon.com/\n *\n * Licensed under the Mozilla Public License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     https://www.mozilla.org/en-US/MPL/2.0/\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { createRouteRef } from '@backstage/core-plugin-api';\n\nexport const rootRouteRef = createRouteRef({\n  id: 'backstage-plugin-changelog',\n});\n","/*\n * Copyright 2023 RSC-Labs, https://rsoftcon.com/\n *\n * Licensed under the Mozilla Public License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     https://www.mozilla.org/en-US/MPL/2.0/\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { generatePath } from 'react-router-dom';\nimport { DiscoveryApi, FetchApi } from '@backstage/core-plugin-api';\nimport { Entity, DEFAULT_NAMESPACE } from '@backstage/catalog-model';\nimport { ResponseError } from '@backstage/errors';\nimport { ChangelogApi } from './ChangelogApi';\n\n\n/** @public */\nexport class ChangelogClient implements ChangelogApi {\n  private readonly discoveryApi: DiscoveryApi;\n  private readonly fetchApi: FetchApi;\n\n  public constructor(options: {\n    discoveryApi: DiscoveryApi;\n    fetchApi: FetchApi;\n  }) {\n    this.discoveryApi = options.discoveryApi;\n    this.fetchApi = options.fetchApi;\n  }\n\n  private getEntityRouteParams(entity: Entity) {\n    return {\n      kind: entity.kind.toLocaleLowerCase('en-US'),\n      namespace:\n        entity.metadata.namespace?.toLocaleLowerCase('en-US') ??\n        DEFAULT_NAMESPACE,\n      name: entity.metadata.name,\n    };\n  }\n\n  public async readChangelog(entity: Entity): Promise<string> {\n        const routeParams = this.getEntityRouteParams(entity);\n        const path = generatePath(`:namespace/:kind/:name`, routeParams);\n        const baseUrl = await this.discoveryApi.getBaseUrl('changelog');\n        const response = await this.fetchApi.fetch(`${baseUrl}/entity/${path}`);\n        if (!response.ok) {\n            throw await ResponseError.fromResponse(response);\n        }\n        const result = await response.json();\n        return result.content;\n    }\n}","/*\n * Copyright 2023 RSC-Labs, https://rsoftcon.com/\n *\n * Licensed under the Mozilla Public License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     https://www.mozilla.org/en-US/MPL/2.0/\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { createApiFactory, createComponentExtension, createPlugin, discoveryApiRef, fetchApiRef } from '@backstage/core-plugin-api';\nimport { changelogApiRef } from './api';\n\nimport { rootRouteRef } from './routes';\nimport { ChangelogClient } from './api/ChangelogClient';\n\n/** @public */\nexport const backstagePluginChangelogPlugin = createPlugin({\n  id: 'changelog',\n  apis: [\n    createApiFactory({\n      api: changelogApiRef,\n      deps: {\n        discoveryApi: discoveryApiRef,\n        fetchApi: fetchApiRef\n      },\n      factory: ({  discoveryApi, fetchApi }) =>\n        new ChangelogClient({\n          discoveryApi,\n          fetchApi\n        }),\n    }),\n  ],\n  routes: {\n    root: rootRouteRef,\n  },\n});\n\n/** @public */\nexport const EntityChangelogCard = backstagePluginChangelogPlugin.provide(\n  createComponentExtension({\n    name: 'EntityChangelogCard',\n    component: {\n      lazy: () =>\n        import('./components').then(m => m.ChangelogCard),\n    },\n  }),\n);\n\n/** @public */\nexport const EntityChangelogContent = backstagePluginChangelogPlugin.provide(\n  createComponentExtension({\n    name: 'EntityChangelogContent',\n    component: {\n      lazy: () =>\n        import('./components').then(m => m.ChangelogContent),\n    },\n  }),\n);","/*\n * Copyright 2023 RSC-Labs, https://rsoftcon.com/\n *\n * Licensed under the Mozilla Public License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     https://www.mozilla.org/en-US/MPL/2.0/\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Entity, ANNOTATION_SOURCE_LOCATION } from '@backstage/catalog-model';\n\n/** @public */\nexport const CHANGELOG_ANNOTATION_REF = 'changelog-file-ref';\n/** @public */\nexport const CHANGELOG_ANNOTATION_NAME = 'changelog-name';\n\n/** @public */\nexport const isChangelogAnnotationConfigurationOk = (entity: Entity) : boolean => {\n  if (Boolean(entity.metadata.annotations?.[CHANGELOG_ANNOTATION_REF])) {\n    return true;\n  }\n  if (Boolean(entity.metadata.annotations?.[CHANGELOG_ANNOTATION_NAME]) && Boolean(entity.metadata.annotations?.[ANNOTATION_SOURCE_LOCATION])) {\n    return true;\n  }\n  if (Boolean(entity.metadata.annotations?.[ANNOTATION_SOURCE_LOCATION])) {\n    return true;\n  }\n  return false;\n}\n\n/** @public */\nexport const getInfoAboutChangelogAnnotationConfiguration = (entity: Entity) : string => {\n\n  if (Boolean(entity.metadata.annotations?.[CHANGELOG_ANNOTATION_NAME]) && !Boolean(entity.metadata.annotations?.[ANNOTATION_SOURCE_LOCATION])) {\n    return `Annotation \"${CHANGELOG_ANNOTATION_NAME}\" needs to be set together with \"${ANNOTATION_SOURCE_LOCATION}\" annotation`;\n  }\n\n  if (!Boolean(entity.metadata.annotations?.[CHANGELOG_ANNOTATION_REF]) && !Boolean(entity.metadata.annotations?.[ANNOTATION_SOURCE_LOCATION])) {\n    return `Annotations are missing - \"${CHANGELOG_ANNOTATION_REF}\" or \"${ANNOTATION_SOURCE_LOCATION}\" or \"${CHANGELOG_ANNOTATION_NAME}\" with \"${ANNOTATION_SOURCE_LOCATION}\"`;\n  }\n  return 'Annotations are ok';\n}\n\n"],"names":[],"mappings":"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"}